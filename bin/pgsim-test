#!/bin/sh
set -e

MONOREPO_ROOT="$(git rev-parse --show-toplevel)"
DOCKER_IMAGE="postgres:11.8-alpine"

# Generate output using pgsim
cd $MONOREPO_ROOT/core
yarn install 
yarn generate

# Generate output using postgres
docker run --rm --name pg -e POSTGRES_PASSWORD=1234 -d $DOCKER_IMAGE
docker run --rm -t -i -v $MONOREPO_ROOT:/pgsim -e POSTGRES_PASSWORD=1234 --link pg $DOCKER_IMAGE /pgsim/fixtures/generate
docker kill pg

# Diff results of postgres and PGSIM output
# TODO